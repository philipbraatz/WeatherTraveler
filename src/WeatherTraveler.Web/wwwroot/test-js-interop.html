<!DOCTYPE html>
<html>
<head>
    <title>JavaScript Interop Test</title>
</head>
<body>
    <h1>JavaScript Download Function Test</h1>
    <button onclick="testDownload()">Test Download Function</button>
    
    <script>
        // Copy the exact same downloadFile function from index.html
        window.downloadFile = function (filename, content, contentType) {
            console.log('=== downloadFile function called ===');
            console.log('Function arguments:', { 
                filename: filename, 
                contentLength: content?.length, 
                contentType: contentType,
                contentPreview: content?.substring(0, 100) + '...'
            });
            
            try {
                if (!filename || !content) {
                    console.error('downloadFile: Missing filename or content');
                    return false;
                }
                
                const blob = new Blob([content], { type: contentType || 'application/octet-stream' });
                console.log('downloadFile: Blob created, size:', blob.size, 'type:', blob.type);
                
                const url = window.URL.createObjectURL(blob);
                console.log('downloadFile: Object URL created:', url);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.style.display = 'none';
                
                document.body.appendChild(a);
                console.log('downloadFile: Anchor element added to DOM, href:', a.href, 'download:', a.download);
                
                // Force the download
                console.log('downloadFile: About to trigger click...');
                a.click();
                console.log('downloadFile: Click triggered!');
                
                // Clean up after a delay
                setTimeout(() => {
                    try {
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                        console.log('downloadFile: Cleanup completed successfully');
                    } catch (cleanupError) {
                        console.error('downloadFile: Cleanup error:', cleanupError);
                    }
                }, 500);
                
                console.log('downloadFile: Returning success = true');
                return true;
            } catch (error) {
                console.error('Error in downloadFile:', error);
                return false;
            }
        };

        function testDownload() {
            const testKml = `<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2">
  <Document>
    <name>Test Route</name>
    <Placemark>
      <name>Test Location</name>
      <Point>
        <coordinates>-104.990300,39.739200,0</coordinates>
      </Point>
    </Placemark>
  </Document>
</kml>`;
            
            console.log('Testing download function...');
            const result = downloadFile('test-route.kml', testKml, 'application/vnd.google-earth.kml+xml');
            console.log('Download function returned:', result);
        }
    </script>
</body>
</html>
